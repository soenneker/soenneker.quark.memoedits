@using Soenneker.Extensions.String
@using Soenneker.Quark.Components.Builders
@using Soenneker.Quark.Components.Builders.Colors
@using Soenneker.Quark.Enums.Size
@inherits Soenneker.Quark.Components.Element

<textarea @attributes="BuildAttributes()">@Value</textarea>

@code {

	[Parameter]
	public string? Value { get; set; }

	[Parameter]
	public string? Placeholder { get; set; }

	[Parameter]
	public bool Disabled { get; set; }

	[Parameter]
	public bool ReadOnly { get; set; }

	[Parameter]
	public bool Required { get; set; }

	[Parameter]
	public int Rows { get; set; } = 3;

	[Parameter]
	public int MaxLength { get; set; }

	[Parameter]
	public int MinLength { get; set; }

	[Parameter]
	public string? Pattern { get; set; }

	[Parameter]
	public bool AutoResize { get; set; }

    [Parameter]
    public CssValue<ColorBuilder> Color { get; set; } = Components.Builders.Colors.Color.Primary;

	[Parameter]
	public Size Size { get; set; } = Size.Default;

	[Parameter]
	public EventCallback<string> ValueChanged { get; set; }

	[Parameter]
	public EventCallback<ChangeEventArgs> OnChange { get; set; }

	[Parameter]
	public EventCallback<ChangeEventArgs> OnInput { get; set; }

	private string? GetColorClass()
    {
        var isTheme = Color.TryGetBootstrapThemeToken(out string token);

		if (isTheme)
			return $"form-control-{token}";

		return null;
	}

	private string? GetSizeClass()
	{
		if (Size != Size.Default)
			return $"form-control-{Size.Value}";

		return null;
	}

	protected override Dictionary<string, object> BuildAttributes()
	{
		Dictionary<string, object> attributes = base.BuildAttributes();

		var baseClasses = "form-control";
		string? colorClass = GetColorClass();
		string? sizeClass = GetSizeClass();

		if (colorClass != null)
			baseClasses = $"{baseClasses} {colorClass}";

		if (sizeClass != null)
			baseClasses = $"{baseClasses} {sizeClass}";

		AppendToClassAttr(attributes, baseClasses);

		if (!string.IsNullOrEmpty(Placeholder))
			attributes["placeholder"] = Placeholder;

		if (Disabled)
			attributes["disabled"] = true;

		if (ReadOnly)
			attributes["readonly"] = true;

		if (Required)
			attributes["required"] = true;

		if (Rows > 0)
			attributes["rows"] = Rows;

		if (MaxLength > 0)
			attributes["maxlength"] = MaxLength;

		if (MinLength > 0)
			attributes["minlength"] = MinLength;

		if (Pattern.HasContent())
			attributes["pattern"] = Pattern;

		if (AutoResize)
			AppendStyleDeclAttr(attributes, "resize: vertical; min-height: 60px;");

		return attributes;
	}

}